<?xml version="1.0" encoding="UTF-8" ?>

<list>
	<dataSource name="fakhim" dbConnectionRef="payam3">
		<sql>
			<![CDATA[
			select distinct
				case when to_number(t_phidt.c_is_doc_receipt)=1 then 'رسید' else 'حواله' end doc_type ,
				to_date('1970-01-01 00','yyyy-mm-dd hh24') + (t_phidt.c_inserttime)/1000/60/60/24 insert_time ,
				ce.c_value doc_status,
				t_item.c_name item_name ,
				t_phidat.c_main_measuring_unit_value main_value,
				muea.c_name main_measuring,
				t_plsi.c_id plan_space_item_id
			from
				t_physical_item_document t_phidt  join t_physitemdocdet t_phidd on t_phidt.c_id = t_phidd.c_item_doc_details
				join t_plan_space_item t_plsi on t_phidd.c_plan_space_item_id = t_plsi.c_id
				join t_physitemdetatt t_phidat on t_phidd.c_item_doc_att_value = t_phidat.c_id
				join t_item t_item on t_plsi.c_item_id = t_item.c_id
				join t_item_attr_value iattr on t_item.c_main_measuring_attr_value_id = iattr.c_id
				join t_measuring_unit muea on iattr.c_measuring_unit_id = muea.c_id
				join t_category_element ce on ce.c_id = t_phidt.c_doc_status_ctgr
			]]>
		</sql>
		<fields>
			<field name="doc_type" type="String" title="نوع سند"/>
			<field name="doc_status" type="String" title="وضعیت سند "/>
			<field name="insert_time" type="DateTime" filterType="Range" title="تاریخ صدور سند"/>
			<field name="item_name" type="String" title="نام کالا"/>
			<field name="main_value" type="String" title="مقدار (واحد اصلی)"/>
			<field name="main_measuring" type="String" title="واحد اصلی"/>
			<field name="plan_space_item_id" type="LookUp" title="Plan Space">
				<sqlOpt>
					<![CDATA[
					select
						t_plsi.c_id psid,
						t_plsi.c_name psname
					from
						t_plan_space_item t_plsi
					]]>
				</sqlOpt>
			</field>
		</fields>
	</dataSource>

	<dataSource name="ItemDS" dbConnectionRef="payam5">
		<sql>
			<![CDATA[
			select
				it.c_id,
				it.c_name,
				it.c_english_name,
				to_number(it.c_active) c_active,
				it.c_technical_code,
				to_date('1970-01-01 00','yyyy-mm-dd hh24') + (it.c_inserttime)/1000/60/60/24 as c_insert_time,
				it.c_main_measuring_attr_value_id,
				itattr.c_value as c_main_measuring
			from
				t_item it
				join t_item_attr_value itattr on itattr.c_id = it.c_main_measuring_attr_value_id
        	]]>
		</sql>

		<fields>
			<field name="c_id" type="Integer" title="شناسه"/>
			<field name="c_name" type="String" filterType="Contain" title="نام"/>
			<field name="c_english_name" filterType="Contain" type="String" title="نام انگلیسی"/>
			<field name="c_active" type="Boolean" title="فعال"/>
			<field name="c_technical_code" type="String" title="کد فنی"/>
			<field name="c_insert_time" type="DateTime" filterType="Range" title="تاریخ ایجاد"/>
			<field name="c_main_measuring" type="String" title="Main Measuring"/>
			<field name="c_main_measuring_attr_value_id" type="LookUp" filterType="List" title="Measure">
				<sqlOpt>
					<![CDATA[
					select
						c_id,
						c_value
					from
						t_item_attr_value
					where
						c_value is not null
					]]>
				</sqlOpt>
			</field>
		</fields>

		<!--<params>
			<param name="" type="" title=""/>
		</params>-->
	</dataSource>
</list>